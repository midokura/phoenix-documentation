"use strict";(globalThis.webpackChunkfoo=globalThis.webpackChunkfoo||[]).push([[4232],{4065(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"service-operator/INSTALL_BAREMETAL_NODE","title":"Ironic Baremetal Node Creation","description":"Description","source":"@site/versioned_docs/version-v1.1/service-operator/INSTALL_BAREMETAL_NODE.md","sourceDirName":"service-operator","slug":"/service-operator/INSTALL_BAREMETAL_NODE","permalink":"/phoenix-documentation/docs/v1.1/service-operator/INSTALL_BAREMETAL_NODE","draft":false,"unlisted":false,"tags":[],"version":"v1.1","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"IaaS Console Configuration","permalink":"/phoenix-documentation/docs/v1.1/service-operator/IAAS_CONSOLE_CONFIGURATION"},"next":{"title":"Network Control Node Setup","permalink":"/phoenix-documentation/docs/v1.1/service-operator/NETWORK_CONTROL_NODE_SETUP"}}');var a=t(4848),s=t(8453);const o={},i="Ironic Baremetal Node Creation",l={},c=[{value:"Description",id:"description",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Process",id:"process",level:2},{value:"Process Overview",id:"process-overview",level:3},{value:"Provisioning a Node",id:"provisioning-a-node",level:3},{value:"1. Create the baremetal node",id:"1-create-the-baremetal-node",level:4},{value:"2. Create the neutron port",id:"2-create-the-neutron-port",level:4},{value:"3. Put node into manage mode",id:"3-put-node-into-manage-mode",level:4},{value:"4. Inspect the node",id:"4-inspect-the-node",level:4},{value:"5. Make node available",id:"5-make-node-available",level:4},{value:"6. Create userdata file",id:"6-create-userdata-file",level:4},{value:"7. Create the server",id:"7-create-the-server",level:4},{value:"8. Switch to the tenant network",id:"8-switch-to-the-tenant-network",level:4}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"ironic-baremetal-node-creation",children:"Ironic Baremetal Node Creation"})}),"\n",(0,a.jsx)(n.h2,{id:"description",children:"Description"}),"\n",(0,a.jsx)(n.p,{children:"This document covers the required infrastructure setup, the step-by-step process for registering and deploying physical servers, and reference information about Ironic's architecture including networks, services, and deployment mechanisms."}),"\n",(0,a.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["From ",(0,a.jsx)(n.code,{children:"bastion0"}),", use the asset ",(0,a.jsx)(n.code,{children:"./scripts/main.sh --shell"})," to get access to openstack cli."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:["Run ",(0,a.jsx)(n.code,{children:"source <(ansible-vault view --vault-password-file /secrets/vault-key.txt /infra-management/config/admin-openrc.sh)"})," to get the credentials into the environment."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Create baremetal flavor"})}),"\n",(0,a.jsx)(n.p,{children:'You need to define a "flavor" that tells OpenStack this is for baremetal servers, not virtual machines. The special resource properties ensure OpenStack knows to provision a full physical server instead of trying to create a VM.'}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:" openstack flavor create \\\n     --ram 262144 \\\n     --disk 3725 \\\n     --vcpus 8 \\\n     --property resources:CUSTOM_BAREMETAL=1 \\\n     --property resources:VCPU=0 \\\n     --property resources:MEMORY_MB=0 \\\n     --property resources:DISK_GB=0 \\\n     baremetal-flavor\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Create the tenant network"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"openstack network create \\\n  --provider-network-type vlan \\\n  --provider-physical-network physnet1 \\\n  --provider-segment 1001 tenant-a-net \\\n  tenant-net\n\nopenstack subnet create \\\n  --network tenant-net \\\n  --subnet-range 10.40.1.0/24 \\\n  --dhcp \\\n  --allocation-pool start=10.40.1.10,end=10.40.1.254 \\\n  --gateway 10.40.1.1 \\\n  --dns-nameserver 10.30.0.1 \\\n  tenant-net-subnet\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Create the tenant external router"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"openstack router create tenant-ext\nopenstack router set tenant-ext --external-gateway external-net\nopenstack router add subnet tenant-ext tenant-net-subnet\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"process",children:"Process"}),"\n",(0,a.jsx)(n.h3,{id:"process-overview",children:"Process Overview"}),"\n",(0,a.jsx)(n.p,{children:"The provisioning process involves several state transitions:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Enroll \u2192 Manageable"}),": Verify Ironic can communicate with the server's BMC"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Manageable \u2192 Inspecting \u2192 Manageable"}),": Discover hardware specifications"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Manageable \u2192 Available"}),": Clean the server and prepare it for deployment"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Available \u2192 Deploying \u2192 Active"}),": Install the OS and boot into production"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"provisioning-a-node",children:"Provisioning a Node"}),"\n",(0,a.jsx)(n.p,{children:"This assumes you already have access to OpenStack from the client and you have loaded the admin credentials into the environment."}),"\n",(0,a.jsx)(n.h4,{id:"1-create-the-baremetal-node",children:"1. Create the baremetal node"}),"\n",(0,a.jsx)(n.p,{children:"This registers the physical server with Ironic by telling it how to control the machine remotely (via IPMI), where to find the boot images, and what type of hardware resource it is."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'NODE_NAME=test-node-01\nIPMI_ADDRESS="192.168.7.200"\nIPMI_USERNAME="admin"\nIPMI_PASSWORD=""\nMAC_ADDRESS="3c:fd:fe:9e:6d:d0"\n# Update with images IDs from `openstack image list`\nDEPLOY_KERNEL="$(openstack image show deploy-kernel -f value -c id)"\nDEPLOY_RAMDISK="$(openstack image show deploy-ramdisk -f value -c id)"\nRESOURCE_CLASS="baremetal"\n\nopenstack baremetal node create \\\n  --name $NODE_NAME \\\n  --driver ipmi \\\n  --network-interface neutron \\\n  --driver-info ipmi_address="$IPMI_ADDRESS" \\\n  --driver-info ipmi_username="$IPMI_USERNAME" \\\n  --driver-info ipmi_password="$IPMI_PASSWORD" \\\n  --driver-info deploy_kernel="$DEPLOY_KERNEL" \\\n  --driver-info deploy_ramdisk="$DEPLOY_RAMDISK" \\\n  --resource-class "$RESOURCE_CLASS"\n\nNODE_UUID=$(openstack baremetal node show $NODE_NAME -f value -c uuid)\n'})}),"\n",(0,a.jsx)(n.h4,{id:"2-create-the-neutron-port",children:"2. Create the neutron port"}),"\n",(0,a.jsx)(n.p,{children:"This tells Ironic which network interface (MAC address) on the physical server should be used for network booting and connects it to the proper network infrastructure."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'openstack baremetal port create \\\n  --name $NODE_NAME-port \\\n  --node $NODE_UUID \\\n  --pxe-enabled true \\\n  --physical-network physnet1 \\\n  $MAC_ADDRESS\n\nPORT_UUID=$(openstack baremetal port show $NODE_NAME-port -f value -c uuid)\n\n# We are not sure this is necessary\nopenstack baremetal port set $PORT_UUID \\\n  --local-link-connection switch_id="b0:4f:13:7f:1d:a2" \\\n  --local-link-connection port_id=Ethernet8 \\\n  --local-link-connection switch_info=switch-name\n'})}),"\n",(0,a.jsx)(n.h4,{id:"3-put-node-into-manage-mode",children:"3. Put node into manage mode"}),"\n",(0,a.jsx)(n.p,{children:'This moves the node from "enroll" (just registered) to "manageable" state\u2014Ironic verifies it can actually talk to the server\'s management controller using the IPMI credentials you provided.'}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"openstack baremetal node manage $NODE_UUID\nopenstack baremetal node show $NODE_UUID -f value -c provision_state -c last_error\n"})}),"\n",(0,a.jsx)(n.h4,{id:"4-inspect-the-node",children:"4. Inspect the node"}),"\n",(0,a.jsx)(n.p,{children:"This makes Ironic automatically discover the server's hardware details (CPU, RAM, disks, etc.) by booting a special inspection image and gathering information, which then gets saved to the node's properties."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Optionally we can set an authorized key to ssh into IPA so we can debug\nPUBLIC_IPA_SSH_KEY=""\nopenstack baremetal node set --driver-info kernel_append_params="nofb nomodeset vga=normal \\\nconsole=tty0 console=ttyS0,115200n8 sshkey=\\"$PUBLIC_IPA_SSH_KEY\\"" $NODE_UUID\n\nopenstack baremetal node inspect $NODE_UUID\nopenstack baremetal node show $NODE_UUID -c provision_state -c last_error\n\n# You should see now more properties automatically set\nopenstack baremetal node show "$NODE_NAME" -c properties -c extra\n'})}),"\n",(0,a.jsx)(n.h4,{id:"5-make-node-available",children:"5. Make node available"}),"\n",(0,a.jsx)(n.p,{children:'This moves the node to "available" state, meaning it\'s ready to have operating systems deployed on it\u2014Ironic will also perform automated cleaning (wiping data, resetting BIOS, etc).'}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'openstack baremetal node provide $NODE_UUID\nopenstack baremetal node show "$NODE_NAME" -c provision_state\n'})}),"\n",(0,a.jsx)(n.h4,{id:"6-create-userdata-file",children:"6. Create userdata file"}),"\n",(0,a.jsx)(n.p,{children:"This prepares a cloud-init configuration file that sets up the initial password and SSH access when the operating system first boots. Customize this script with the user needs."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"cat <<EOF > /tmp/userdata.txt\n#cloud-config\npassword: ubuntu\nchpasswd: { expire: False }\nssh_pwauth: True\nEOF\n"})}),"\n",(0,a.jsx)(n.h4,{id:"7-create-the-server",children:"7. Create the server"}),"\n",(0,a.jsx)(n.p,{children:"This actually deploys an operating system image onto the physical server using all the configuration you've set up\u2014it picks the right hardware (using the baremetal flavor), installs the OS image, connects it to the tenant network, and applies the userdata."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'openstack server create \\\n  --flavor baremetal-flavor \\\n  --image "Ubuntu Server Noble LTS (Cloud) raw" \\\n  --key-name everyone \\\n  --network tenant-net \\\n  --user-data /tmp/userdata.txt \\\n  --config-drive true \\\n  my-special-server\n'})}),"\n",(0,a.jsx)(n.h4,{id:"8-switch-to-the-tenant-network",children:"8. Switch to the tenant network"}),"\n",(0,a.jsx)(n.p,{children:"Once the server is provisioned, it will restart again, and at that moment we need to switch in Hedge Hog Switch from the provisioning network to the tenant network."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"ssh core@control-1.bcn\nkubectl delete vpcattachments provision--default--gpu0--frontend--leaf0\nkubectl apply -f tenant0--default--gpu0--frontend--leaf0.yaml\n"})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453(e,n,t){t.d(n,{R:()=>o,x:()=>i});var r=t(6540);const a={},s=r.createContext(a);function o(e){const n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);