"use strict";(globalThis.webpackChunkfoo=globalThis.webpackChunkfoo||[]).push([[7753],{5999(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"service-operator/DEPLOYMENT","title":"Deployment Scripts","description":"This guide walks you through deploying GPU infrastructure clusters using containerized Ansible automation.","source":"@site/versioned_docs/version-v1.5/service-operator/DEPLOYMENT.md","sourceDirName":"service-operator","slug":"/service-operator/DEPLOYMENT","permalink":"/foo/docs/service-operator/DEPLOYMENT","draft":false,"unlisted":false,"tags":[],"version":"v1.5","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Setup Ceph - Generic","permalink":"/foo/docs/service-operator/CEPH_SETUP"},"next":{"title":"GitHub Container Registry (GHCR) Authentication","permalink":"/foo/docs/service-operator/GHCR_AUTHENTICATION"}}');var r=s(4848),l=s(8453);const t={},c="Deployment Scripts",o={},d=[{value:"Before You Start",id:"before-you-start",level:2},{value:"Prerequisites Checklist",id:"prerequisites-checklist",level:3},{value:"Container Runtime",id:"container-runtime",level:3},{value:"Registry Authentication",id:"registry-authentication",level:3},{value:"Vault Password",id:"vault-password",level:3},{value:"SSH Keys",id:"ssh-keys",level:3},{value:"Ceph Keyrings",id:"ceph-keyrings",level:3},{value:"VM Images",id:"vm-images",level:3},{value:"Inventory File",id:"inventory-file",level:3},{value:"Quick Start",id:"quick-start",level:2},{value:"First-Time Setup",id:"first-time-setup",level:3},{value:"Complete Deployment",id:"complete-deployment",level:3},{value:"Verify Deployment Success",id:"verify-deployment-success",level:3},{value:"Partial Execution",id:"partial-execution",level:3},{value:"Options and Configuration",id:"options-and-configuration",level:2},{value:"Configuration Methods",id:"configuration-methods",level:3},{value:"Script-specific Options",id:"script-specific-options",level:3},{value:"platform-setup.sh",id:"platform-setupsh",level:4},{value:"load-container.sh",id:"load-containersh",level:4},{value:"Common Configuration Options",id:"common-configuration-options",level:3},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Available Ansible Tags",id:"available-ansible-tags",level:3},{value:"Logs",id:"logs",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Container not found",id:"container-not-found",level:3},{value:"Vault password errors",id:"vault-password-errors",level:3},{value:"SSH connection failures",id:"ssh-connection-failures",level:3},{value:"Script failures",id:"script-failures",level:3},{value:"Security Notes",id:"security-notes",level:2},{value:"Support",id:"support",level:2},{value:"File Structure",id:"file-structure",level:3},{value:"Scripts Overview",id:"scripts-overview",level:3},{value:"Timeline",id:"timeline",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"deployment-scripts",children:"Deployment Scripts"})}),"\n",(0,r.jsx)(n.p,{children:"This guide walks you through deploying GPU infrastructure clusters using containerized Ansible automation.\nThe deployment scripts handle the complete setup of OpenStack, management clusters, and observability stack on physical infrastructure."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Getting the Release Package:"})}),"\n",(0,r.jsx)(n.p,{children:"Download the latest release from the provided URL"}),"\n",(0,r.jsx)(n.h2,{id:"before-you-start",children:"Before You Start"}),"\n",(0,r.jsx)(n.p,{children:"Before running the deployment, you need to prepare several things. We'll go through them one by one."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note:"})," All default paths below can be customized using CLI arguments (see ",(0,r.jsx)(n.a,{href:"#options-and-configuration",children:"Options and Configuration"}),")."]}),"\n",(0,r.jsx)(n.h3,{id:"prerequisites-checklist",children:"Prerequisites Checklist"}),"\n",(0,r.jsx)(n.p,{children:"Quick verification checklist. Click any item for detailed setup instructions below."}),"\n",(0,r.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,r.jsx)(n.strong,{children:"Container Runtime"})," - Podman or Docker installed \u2192 ",(0,r.jsx)(n.a,{href:"#container-runtime",children:"Details"})]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,r.jsx)(n.strong,{children:"Registry Authentication"})," - Authenticated to ghcr.io for pulling private images \u2192 ",(0,r.jsx)(n.a,{href:"#registry-authentication",children:"Details"})]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,r.jsx)(n.strong,{children:"Vault Password"})," - Know the password (will be prompted) \u2192 ",(0,r.jsx)(n.a,{href:"#vault-password",children:"Details"})]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,r.jsx)(n.strong,{children:"SSH Keys"})," - Have controller access key in ",(0,r.jsx)(n.code,{children:"~/.ssh/"})," \u2192 ",(0,r.jsx)(n.a,{href:"#ssh-keys",children:"Details"})]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,r.jsx)(n.strong,{children:"Ceph Keyrings"})," - three keyring files in ",(0,r.jsx)(n.code,{children:"./keyrings/"})," (cinder, cinder-backup, glance) \u2192 ",(0,r.jsx)(n.a,{href:"#ceph-keyrings",children:"Details"})]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,r.jsx)(n.strong,{children:"Disk Space"})," - 30 GB free in ",(0,r.jsx)(n.code,{children:"~/.cache/gpu-infrastructure/"})," for VM images \u2192 ",(0,r.jsx)(n.a,{href:"#vm-images",children:"Details"})]}),"\n",(0,r.jsxs)(n.li,{className:"task-list-item",children:[(0,r.jsx)(n.input,{type:"checkbox",disabled:!0})," ",(0,r.jsx)(n.strong,{children:"Inventory File"})," - ",(0,r.jsx)(n.code,{children:"./inventory.yml"})," present and valid \u2192 ",(0,r.jsx)(n.a,{href:"#inventory-file",children:"Details"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"container-runtime",children:"Container Runtime"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"What it is:"})," Container runtime (Podman or Docker) to run the deployment automation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Purpose:"})," Runs the Ansible container with all deployment tools pre-installed"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Where to get it:"})," Install ",(0,r.jsx)(n.a,{href:"https://podman.io/docs/installation",children:"Podman"})," or ",(0,r.jsx)(n.a,{href:"https://docs.docker.com/get-started/get-docker/",children:"Docker"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"registry-authentication",children:"Registry Authentication"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"What it is:"})," GitHub Container Registry (GHCR) credentials for pulling private container images"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose:"})," Required for deployment OSt and IaaS Console / Observability containers"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Setup steps:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Create GitHub Personal Access Token with ",(0,r.jsx)(n.code,{children:"read:packages"})," scope (",(0,r.jsx)(n.a,{href:"https://github.com/settings/tokens",children:"Token Settings"}),")"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Authenticate to registry:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"export CR_PAT=YOUR_TOKEN\necho $CR_PAT | podman login ghcr.io -u USERNAME --password-stdin\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Encrypt token: ",(0,r.jsx)(n.code,{children:"ansible-vault encrypt_string 'ghp_YourToken' --name 'ghcr_pat' --ask-vault-password"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Add to ",(0,r.jsx)(n.code,{children:"inventory.yml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'all:\n  vars:\n    iaas_console:\n      ghcr_user: "your-github-username"\n      ghcr_pat: !vault |\n        $ANSIBLE_VAULT;1.1;AES256\n        ... encrypted token ...\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Important:"})," Always encrypt PAT in inventory.yml, never commit unencrypted secrets"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"vault-password",children:"Vault Password"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"What it is:"})," Password to decrypt and encrypt configuration files"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Purpose:"})," Decrypts secrets in ",(0,r.jsx)(n.code,{children:"inventory.yml"})," and other encrypted configuration files"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"How it works:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"The script prompts you to enter the password interactively at the beginning"}),"\n",(0,r.jsxs)(n.li,{children:["It temporarily stores the password in ",(0,r.jsx)(n.code,{children:"~/vault-key.txt"})," during execution"]}),"\n",(0,r.jsx)(n.li,{children:"The file is automatically removed when the script completes"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"What you need:"})," Just know the password - the script handles the file creation and cleanup"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Important:"})," The local file ",(0,r.jsx)(n.code,{children:"~/vault-key.txt"})," will be mounted in the container as ",(0,r.jsx)(n.code,{children:"/secrets/vault-key.txt"})," read-only file"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"ssh-keys",children:"SSH Keys"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"What it is:"})," SSH private keys to access cluster nodes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Location:"})," ",(0,r.jsx)(n.code,{children:"~/.ssh/"})," directory and ",(0,r.jsx)(n.code,{children:"~/.ssh/id_ed25519"})," as default private key"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Purpose:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Used for: Deploying OpenStack on physical controller nodes and accessing management VMs (management cluster, observability services)"}),"\n",(0,r.jsxs)(n.li,{children:["Variable in inventory.yml: ",(0,r.jsx)(n.code,{children:"ansible_ssh_private_key_file"})]}),"\n",(0,r.jsxs)(n.li,{children:["Test access: ",(0,r.jsx)(n.code,{children:"ssh -i ~/.ssh/management-key.pem root@your-controller-hostname"})]}),"\n",(0,r.jsxs)(n.li,{children:["Create the keypair if needed: ",(0,r.jsx)(n.code,{children:"ssh-keygen -t ed25519 -f ~/.ssh/management-key.pem"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Important:"})," Always use ",(0,r.jsx)(n.code,{children:"~/.ssh/"})," paths in your ",(0,r.jsx)(n.code,{children:"inventory.yml"}),". Your ",(0,r.jsx)(n.code,{children:"~/.ssh/"})," directory is automatically mounted inside the container as a read-only directory"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"ceph-keyrings",children:"Ceph Keyrings"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"What it is:"})," Authentication credentials for Ceph storage backend"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Location:"})," ",(0,r.jsx)(n.code,{children:"./keyrings/"})," directory"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"keyrings/\n\u251c\u2500\u2500 ceph.client.cinder-backup.keyring\n\u251c\u2500\u2500 ceph.client.cinder.keyring\n\u2514\u2500\u2500 ceph.client.glance.keyring\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Purpose:"})," Allows OpenStack services (Cinder, Glance, Nova) to access Ceph storage"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Inventory configuration:"})," Your ",(0,r.jsx)(n.code,{children:"inventory.yml"})," should reference these files:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'ceph_cinder_backup_keyring: "{{ playbook_dir }}/../../keyrings/ceph.client.cinder-backup.keyring"\nceph_cinder_keyring: "{{ playbook_dir }}/../../keyrings/ceph.client.cinder.keyring"\nceph_glance_keyring: "{{ playbook_dir }}/../../keyrings/ceph.client.glance.keyring"\nceph_nova_keyring: "{{ playbook_dir }}/../../keyrings/ceph.client.cinder.keyring"\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Important:"})," The local ",(0,r.jsx)(n.code,{children:"./keyrings"})," will be mounted inside the container as ",(0,r.jsx)(n.code,{children:"/keyrings"})," read-only directory."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"vm-images",children:"VM Images"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"What it is:"})," VM images (Cirros, Ubuntu, Phoenix with CUDA) for provisioning VMs and BMs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Location:"})," ",(0,r.jsx)(n.code,{children:"~/.cache/gpu-infrastructure/images"})," (default)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Purpose:"})," First deployment downloads images, converts them from qcow2 to raw format, and uploads to OpenStack Glance. Subsequent deployments reuse cached images"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Requirements:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"~30 GB free disk space"}),"\n",(0,r.jsx)(n.li,{children:"Internet connectivity during first deployment to download the images if needed"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Optional:"})," Pre-populate the cache directory if you have the images available offline"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Important:"})," Your ",(0,r.jsx)(n.code,{children:"~/.cache/gpu-infrastructure/"})," directory is automatically mounted inside the container at ",(0,r.jsx)(n.code,{children:"/root/.cache/gpu-infrastructure"})," as a writable directory"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"inventory-file",children:"Inventory File"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"What it is:"})," Configuration file defining OpenStack cloud connection and resources (networks, flavors, images, VMs)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Location:"})," ",(0,r.jsx)(n.code,{children:"./inventory.yml"})," in the release-assets directory"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Template:"})," See ",(0,r.jsx)(n.code,{children:"inventory.example.yml"})," for an example with configuration options"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Purpose:"})," Tells Ansible how to connect to your OpenStack deployment and what resources to provision."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Important:"})," Your ",(0,r.jsx)(n.code,{children:"./inventory.yml"})," file is automatically mounted inside the container at ",(0,r.jsx)(n.code,{children:"/inventory.yml"})," as a read-only file"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note:"})," All commands below assume you're in the ",(0,r.jsx)(n.code,{children:"release-assets/"})," directory."]}),"\n",(0,r.jsx)(n.h3,{id:"first-time-setup",children:"First-Time Setup"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Connect into the bastion host with ssh: ",(0,r.jsx)(n.code,{children:"ssh ubuntu@<bastion0 domain>"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Download the release package from the provided URL: ",(0,r.jsx)(n.code,{children:"curl <artifact url> -O release-assets.tar.gz"})]}),"\n",(0,r.jsxs)(n.li,{children:["Extract the tar.gz archive into a folder called ",(0,r.jsx)(n.code,{children:"release-assets"}),":\n",(0,r.jsx)(n.code,{children:"mkdir release-assets && tar -xzf release-assets.tar.gz -C release-assets"})]}),"\n",(0,r.jsxs)(n.li,{children:["Change to release directory: ",(0,r.jsx)(n.code,{children:"cd release-assets"})]}),"\n",(0,r.jsxs)(n.li,{children:["Verify checksums: ",(0,r.jsx)(n.code,{children:"sha256sum -c SHA256SUMS"})]}),"\n",(0,r.jsxs)(n.li,{children:["Copy the crafted ",(0,r.jsx)(n.code,{children:"inventory.yml"})," into the bastion: ",(0,r.jsx)(n.code,{children:"scp ./inventory.yml ubuntu@<bastion0 domain>:release-assets/"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"complete-deployment",children:"Complete Deployment"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Run master script: ",(0,r.jsx)(n.code,{children:"./scripts/platform-setup.sh"})]}),"\n",(0,r.jsx)(n.li,{children:"Enter vault password when prompted"}),"\n",(0,r.jsx)(n.li,{children:"Wait for deployment to complete (1-2 hours)"}),"\n",(0,r.jsxs)(n.li,{children:["Review logs in ",(0,r.jsx)(n.code,{children:"logs/"})]}),"\n",(0,r.jsx)(n.li,{children:"Verify services are running (see below)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"verify-deployment-success",children:"Verify Deployment Success"}),"\n",(0,r.jsx)(n.p,{children:"After deployment completes, verify that all services are running correctly:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Check that deployment completed successfully\ntail -50 logs/main-*.log | grep -i "success\\\\|complete\\\\|failed"\n\n# Verify OpenStack services (if OpenStack was deployed)\n./scripts/platform-setup.sh --shell\nsource <(ansible-vault view --vault-password-file /secrets/vault-key.txt /infra-management/config/admin-openrc.sh)\nopenstack server list  # Should show VMs if management cluster/observability were deployed\n\n# Verify management cluster (if management cluster was deployed)\nexport KUBECONFIG=/infra-management/kubeconfig\nkubectl get nodes  # Should show Ready status\nkubectl get pods -A  # Should show Running pods\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Success indicators:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 All Ansible tasks completed without failures"}),"\n",(0,r.jsx)(n.li,{children:'\u2705 Management cluster nodes show "Ready" status'}),"\n",(0,r.jsx)(n.li,{children:'\u2705 All pods show "Running" or "Completed" status'}),"\n",(0,r.jsx)(n.li,{children:"\u2705 No error messages in logs"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"If you see failures:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Check the logs in ",(0,r.jsx)(n.code,{children:"logs/main-*.log"})," for error details"]}),"\n",(0,r.jsxs)(n.li,{children:["See ",(0,r.jsx)(n.a,{href:"#partial-execution",children:"Partial Execution"})," below to retry specific steps"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"partial-execution",children:"Partial Execution"}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"--tags"})," and ",(0,r.jsx)(n.code,{children:"--skip-tags"})," to control which steps run.\nSee (",(0,r.jsx)(n.a,{href:"#available-ansible-tags",children:"full list"}),") of available tags for more details."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Run specific components\n./scripts/platform-setup.sh --tags openstack\n./scripts/platform-setup.sh --tags openstack,provision-demo\n\n# Skip specific components\n./scripts/platform-setup.sh --skip-tags observability\n\n# Combine with script flags and other options\n./scripts/platform-setup.sh --skip-load-container --inventory custom.yml --tags management -vvv\n"})}),"\n",(0,r.jsx)(n.h2,{id:"options-and-configuration",children:"Options and Configuration"}),"\n",(0,r.jsx)(n.h3,{id:"configuration-methods",children:"Configuration Methods"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Priority order:"})," CLI arguments > Environment variables > Defaults (CLI args recommended)"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Example: CLI arguments override environment variables\nexport INVENTORY=old.yml\n./scripts/platform-setup.sh --inventory new.yml  # Uses new.yml\n"})}),"\n",(0,r.jsx)(n.h3,{id:"script-specific-options",children:"Script-specific Options"}),"\n",(0,r.jsx)(n.h4,{id:"platform-setupsh",children:"platform-setup.sh"}),"\n",(0,r.jsx)(n.p,{children:"These control the behavior of the main deployment script:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--shell"})," - Open interactive shell in container (skips deployment)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--skip-load-container"})," - Skip container loading step"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--help"})," - Show help message"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"load-containersh",children:"load-container.sh"}),"\n",(0,r.jsx)(n.p,{children:"These control the container image loading (one-time setup):"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--image-file PATH"})," - Path to container image tar file (default: ",(0,r.jsx)(n.code,{children:"./container-image.tar"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--help"})," - Show help message"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"common-configuration-options",children:"Common Configuration Options"}),"\n",(0,r.jsx)(n.p,{children:"These options are shared across all scripts and can be specified via CLI arguments or environment variables:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"CLI Argument"}),(0,r.jsx)(n.th,{children:"Environment Variable"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"-i, --inventory PATH"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"INVENTORY"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"./inventory.yml"})}),(0,r.jsx)(n.td,{children:"Ansible inventory file"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--vault-file PATH"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"VAULT_FILE"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"~/vault-key.txt"})}),(0,r.jsx)(n.td,{children:"Vault password file"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--ssh-dir PATH"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SSH_DIR"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"~/.ssh"})}),(0,r.jsx)(n.td,{children:"SSH directory path"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--cache-dir PATH"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"CACHE_DIR"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"~/.cache/gpu-infrastructure"})}),(0,r.jsx)(n.td,{children:"Cache directory for images"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--keyrings-dir PATH"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"KEYRINGS_DIR"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"./keyrings"})}),(0,r.jsx)(n.td,{children:"Ceph keyrings directory"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"--assets-dir PATH"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ASSETS_DIR"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"./assets/"})}),(0,r.jsx)(n.td,{children:"Generated assets directory"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"These are configured via environment variables only:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"LOG_DIR"})," - Log directory (default: ",(0,r.jsx)(n.code,{children:"./logs"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Container image:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"IMAGE_NAME"})," - Container image name (default: ",(0,r.jsx)(n.code,{children:"ghcr.io/midokura/gpu-infra-ansible"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"IMAGE_TAG"})," - Container image tag (default: ",(0,r.jsx)(n.code,{children:"release"}),")"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["All other arguments are passed directly to ",(0,r.jsx)(n.code,{children:"ansible-playbook"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--tags TAG1,TAG2"})," - Run specific tagged steps (",(0,r.jsx)(n.a,{href:"https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_tags.html#selecting-or-skipping-tags-when-you-run-a-playbook",children:"docs"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--skip-tags TAG1,TAG2"})," - Skip specific tagged steps"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"--extra-vars KEY=VALUE"})," - Pass additional variables to playbook (for example, ",(0,r.jsx)(n.code,{children:'--extra-vars "debug=true"'}),") (",(0,r.jsx)(n.a,{href:"https://docs.ansible.com/ansible/latest/playbook_guide/playbooks_variables.html#defining-variables-at-runtime",children:"docs"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"-v"}),", ",(0,r.jsx)(n.code,{children:"-vv"}),", ",(0,r.jsx)(n.code,{children:"-vvv"})," - Verbose output"]}),"\n",(0,r.jsx)(n.li,{children:"Any other ansible-playbook flags"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,r.jsxs)(n.p,{children:["All scripts use common environment variables defined in ",(0,r.jsx)(n.code,{children:"common.sh"}),":"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Input parameters:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"VAULT_FILE"})," - Vault password file path (default: ",(0,r.jsx)(n.code,{children:"~/vault-key.txt"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SSH_DIR"})," - SSH directory path (default: ",(0,r.jsx)(n.code,{children:"~/.ssh"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"CACHE_DIR"})," - Cache directory for images and Ansible facts (default: ",(0,r.jsx)(n.code,{children:"~/.cache/gpu-infrastructure"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"KEYRINGS_DIR"})," - Ceph keyrings directory (default: ",(0,r.jsx)(n.code,{children:"./keyrings"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"INVENTORY"})," - Ansible inventory file (default: ",(0,r.jsx)(n.code,{children:"./inventory.yml"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Output parameters:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"LOG_DIR"})," - Log directory (default: ",(0,r.jsx)(n.code,{children:"./logs"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ASSETS_DIR"})," - Generated assets directory (default: ",(0,r.jsx)(n.code,{children:"./assets/"}),")"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"available-ansible-tags",children:"Available Ansible Tags"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Tag"}),(0,r.jsx)(n.th,{children:"Description"}),(0,r.jsx)(n.th,{children:"Sub-tags"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"openstack"})}),(0,r.jsx)(n.td,{children:"Deploy OpenStack via Kolla-Ansible"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"config"}),", ",(0,r.jsx)(n.code,{children:"deploy"}),", ",(0,r.jsx)(n.code,{children:"provision"}),", ",(0,r.jsx)(n.code,{children:"encrypt"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"management"})}),(0,r.jsx)(n.td,{children:"Deploy management cluster"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"management-create"}),", ",(0,r.jsx)(n.code,{children:"management-deploy"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"observability"})}),(0,r.jsx)(n.td,{children:"Deploy observability stack"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"remote-metrics"})})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"logs",children:"Logs"}),"\n",(0,r.jsxs)(n.p,{children:["Deployment logs are stored in ",(0,r.jsx)(n.code,{children:"logs/"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"logs/\n\u251c\u2500\u2500 load-container-YYYYMMDD-HHMMSS.log\n\u2514\u2500\u2500 main-YYYYMMDD-HHMMSS.log\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"main-YYYYMMDD-HHMMSS.log"})," contains output from all deployment steps executed in a single run."]}),"\n",(0,r.jsx)(n.p,{children:"Each log file contains:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Timestamped console output"}),"\n",(0,r.jsx)(n.li,{children:"Ansible playbook execution details"}),"\n",(0,r.jsx)(n.li,{children:"Error messages and stack traces"}),"\n",(0,r.jsx)(n.li,{children:"Execution timing information"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"container-not-found",children:"Container not found"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check if image is loaded\npodman images | grep gpu-infra-ansible\n\n# Load container if missing\n./scripts/load-container.sh\n"})}),"\n",(0,r.jsx)(n.h3,{id:"vault-password-errors",children:"Vault password errors"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Verify vault file exists and has correct permissions\nls -l ~/vault-key.txt\nchmod 600 ~/vault-key.txt\n"})}),"\n",(0,r.jsx)(n.h3,{id:"ssh-connection-failures",children:"SSH connection failures"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Verify SSH access to cluster nodes\nssh root@roquefort.bcn\nssh root@idiazabal.bcn\n"})}),"\n",(0,r.jsx)(n.h3,{id:"script-failures",children:"Script failures"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check logs for details\ntail -f logs/*.log\n\n# Run with verbose output\n./scripts/platform-setup.sh -vvv\n"})}),"\n",(0,r.jsx)(n.h2,{id:"security-notes",children:"Security Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Vault password is stored temporarily in ",(0,r.jsx)(n.code,{children:"~/vault-key.txt"})]}),"\n",(0,r.jsx)(n.li,{children:"File is automatically removed when master script completes"}),"\n",(0,r.jsx)(n.li,{children:"File has restrictive permissions (600) - only readable by owner"}),"\n",(0,r.jsx)(n.li,{children:"Never commit vault password to version control"}),"\n",(0,r.jsx)(n.li,{children:"Keep vault password in a safe place"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"support",children:"Support"}),"\n",(0,r.jsx)(n.p,{children:"For issues or questions:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Check logs in ",(0,r.jsx)(n.code,{children:"logs/"})]}),"\n",(0,r.jsxs)(n.li,{children:["Review script help: ",(0,r.jsx)(n.code,{children:"./scripts/<script-name>.sh --help"})]}),"\n",(0,r.jsx)(n.li,{children:"Run individual scripts for debugging"}),"\n",(0,r.jsx)(n.li,{children:"Contact infrastructure team"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"file-structure",children:"File Structure"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"release-assets/\n\u251c\u2500\u2500 container-image.tar         # Pre-built Ansible container\n\u251c\u2500\u2500 scripts/                    # Deployment scripts\n\u2502   \u251c\u2500\u2500 common.sh               # Shared library (sourced by all scripts)\n\u2502   \u251c\u2500\u2500 platform-setup.sh       # Master orchestration script\n\u2502   \u2514\u2500\u2500 load-container.sh       # Load container image\n\u251c\u2500\u2500 manifest.txt                # Build manifest\n\u251c\u2500\u2500 SHA256SUMS                  # Checksums\n\u2514\u2500\u2500 README.md                   # This file\n\nAdditional files needed for deployment:\n\u251c\u2500\u2500 inventory.yml               # Ansible inventory (environment-specific)\n\u2514\u2500\u2500 keyrings/                   # Ceph client keyrings (environment-specific)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"scripts-overview",children:"Scripts Overview"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"platform-setup.sh"})})," - Thin wrapper for deployment"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Prompts for vault password once (stored temporarily)"}),"\n",(0,r.jsxs)(n.li,{children:["Loads container image (optional ",(0,r.jsx)(n.code,{children:"--skip-load-container"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Passes all arguments directly to ",(0,r.jsx)(n.code,{children:"ansible-playbook"})]}),"\n",(0,r.jsxs)(n.li,{children:["Runs master playbook (",(0,r.jsx)(n.code,{children:"main.yml"}),") with user-provided Ansible flags: ",(0,r.jsx)(n.code,{children:"--tags"}),", ",(0,r.jsx)(n.code,{children:"--skip-tags"}),", ",(0,r.jsx)(n.code,{children:"-v"}),", etc."]}),"\n",(0,r.jsx)(n.li,{children:"Automatic cleanup of temporary files"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"load-container.sh"})})," - Load container image (one-time setup)"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Loads pre-built Ansible container from tar file"}),"\n",(0,r.jsx)(n.li,{children:"Verifies image loaded successfully"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.code,{children:"common.sh"})})," - Shared library for all scripts"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Container runtime detection (Podman/Docker)"}),"\n",(0,r.jsx)(n.li,{children:"Common validation functions (vault, SSH, keyrings, inventory)"}),"\n",(0,r.jsx)(n.li,{children:"Ansible playbook execution wrapper"}),"\n",(0,r.jsx)(n.li,{children:"Error handling and cleanup utilities"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"timeline",children:"Timeline"}),"\n",(0,r.jsx)(n.p,{children:"Typical deployment times (may vary):"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Load container: 2-5 minutes"}),"\n",(0,r.jsx)(n.li,{children:"Deploy OpenStack: 30-60 minutes"}),"\n",(0,r.jsx)(n.li,{children:"Deploy management cluster: 5-10 minutes"}),"\n",(0,r.jsx)(n.li,{children:"Provision observability: 5-10 minutes"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Total: ~1-2 hours"})})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453(e,n,s){s.d(n,{R:()=>t,x:()=>c});var i=s(6540);const r={},l=i.createContext(r);function t(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);